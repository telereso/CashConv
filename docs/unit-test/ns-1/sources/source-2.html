


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>cashconv-client Coverage Report > CashconvClientManager</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope: cashconv-client<span class="separator">|</span>    <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">io.telereso.cashconv.client</a>
</div>

<h1>Coverage Summary for Class: CashconvClientManager (io.telereso.cashconv.client)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
<th class="coverageStat 
">
  Instruction, %
</th>
</tr>
<tr>
  <td class="name">CashconvClientManager</td>
<td class="coverageStat">
  <span class="percent">
    93.3%
  </span>
  <span class="absValue">
    (14/15)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    50%
  </span>
  <span class="absValue">
    (1/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    88%
  </span>
  <span class="absValue">
    (22/25)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    91.7%
  </span>
  <span class="absValue">
    (144/157)
  </span>
</td>
</tr>
  <tr>
    <td class="name">CashconvClientManager$Builder</td>
<td class="coverageStat">
  <span class="percent">
    57.1%
  </span>
  <span class="absValue">
    (8/14)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    66.7%
  </span>
  <span class="absValue">
    (4/6)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    63.6%
  </span>
  <span class="absValue">
    (14/22)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    61.2%
  </span>
  <span class="absValue">
    (52/85)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">CashconvClientManager$Companion</td>
<td class="coverageStat">
  <span class="percent">
    75%
  </span>
  <span class="absValue">
    (3/4)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    50%
  </span>
  <span class="absValue">
    (1/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    85.7%
  </span>
  <span class="absValue">
    (6/7)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    66.7%
  </span>
  <span class="absValue">
    (16/24)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">CashconvClientManager$fetchCurrencies$1</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (12/12)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">CashconvClientManager$fetchCurrenciesIfNeeded$1</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (12/12)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">CashconvClientManager$fetchRates$1</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (12/12)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">CashconvClientManager$fetchRatesIfNeeded$1</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (12/12)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">CashconvClientManager$getCurrencies$1</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (12/12)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">CashconvClientManager$getRates$1</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (12/12)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">CashconvClientManager$load$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
    <td class="coverageStat"/>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/12)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">CashconvClientManager$repo$2</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    2%
  </span>
  <span class="absValue">
    (1/50)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    5%
  </span>
  <span class="absValue">
    (1/20)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    5.7%
  </span>
  <span class="absValue">
    (9/157)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">CashconvClientManager$settingsManager$2</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    25%
  </span>
  <span class="absValue">
    (1/4)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    50%
  </span>
  <span class="absValue">
    (1/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    27.3%
  </span>
  <span class="absValue">
    (6/22)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    78.6%
  </span>
  <span class="absValue">
    (33/42)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    12.5%
  </span>
  <span class="absValue">
    (8/64)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    60.2%
  </span>
  <span class="absValue">
    (50/83)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    56.5%
  </span>
  <span class="absValue">
    (299/529)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package io.telereso.cashconv.client
&nbsp;
&nbsp;import io.telereso.cashconv.client.*
&nbsp;import io.telereso.kmp.core.*
&nbsp;import io.telereso.cashconv.client.cache.SettingsManager
&nbsp;import io.telereso.cashconv.client.remote.CashconvApiService
&nbsp;import kotlinx.coroutines.*
&nbsp;import io.telereso.cashconv.client.repositories.CashconvClientRepository
&nbsp;import io.telereso.cashconv.models.Amount
&nbsp;import io.telereso.cashconv.models.Currency
&nbsp;import io.ktor.client.plugins.*
&nbsp;import io.ktor.client.statement.*
&nbsp;import io.telereso.kmp.annotations.ReactNativeExport
&nbsp;import kotlin.js.ExperimentalJsExport
&nbsp;import kotlin.js.JsExport
&nbsp;import kotlin.js.JsName
&nbsp;import kotlin.jvm.JvmStatic
&nbsp;
&nbsp;/**
&nbsp; * This class acts as the point of entry into the client sdk.
&nbsp; *
&nbsp; * @constructor a private constructor due to the build pattern.
&nbsp; */
<b class="fc">&nbsp;@ExperimentalJsExport</b>
&nbsp;@JsExport
&nbsp;@ReactNativeExport
&nbsp;class CashconvClientManager private constructor(
<b class="fc">&nbsp;    private val builder: Builder,</b>
<b class="nc">&nbsp;    config: Config? = null</b>
&nbsp;) {
&nbsp;
&nbsp;    companion object {
&nbsp;        /**
&nbsp;         * a Kotlin DSL fun that uses scope to build the CashconvClientManager.
&nbsp;         */
&nbsp;        inline fun client(
&nbsp;            block: Builder.() -&gt; Unit
&nbsp;        ) =
<b class="fc">&nbsp;            Builder()</b>
<b class="fc">&nbsp;                .apply(block)</b>
<b class="fc">&nbsp;                .build()</b>
&nbsp;
&nbsp;        private var instance: CashconvClientManager? = null
&nbsp;
&nbsp;        @Throws(NullPointerException::class)
&nbsp;        @JvmStatic
&nbsp;        fun getInstance(): CashconvClientManager {
<b class="pc">&nbsp;            if (instance == null) throw NullPointerException(&quot;CashconvClientManager instance cannot be null!&quot;)</b>
<b class="fc">&nbsp;            return instance!!</b>
&nbsp;        }
&nbsp;
&nbsp;        @JvmStatic
&nbsp;        fun getInstanceOrNull(): CashconvClientManager? {
<b class="fc">&nbsp;            return instance</b>
&nbsp;        }
&nbsp;
&nbsp;        @JvmStatic
&nbsp;        fun builder(): Builder {
<b class="nc">&nbsp;            return Builder()</b>
&nbsp;        }
&nbsp;    }
&nbsp;
<b class="fc">&nbsp;    private val settingsManager by lazy {</b>
<b class="pc">&nbsp;        builder.settingsManager</b>
<b class="nc">&nbsp;            ?: SettingsManager(if (builder.inMemorySettings) Settings.getInMemory() else settings)</b>
&nbsp;    }
&nbsp;
<b class="fc">&nbsp;    private val repo: CashconvClientRepository by lazy {</b>
<b class="pc">&nbsp;        builder.repository ?: run {</b>
<b class="nc">&nbsp;            val httpClient = CashconvApiService.getHttpClient(</b>
<b class="nc">&nbsp;                config?.builder?.logHttpRequests ?: false,</b>
<b class="nc">&nbsp;                config?.builder?.interceptors,</b>
<b class="nc">&nbsp;                config?.builder?.requestTimeoutMillis,</b>
<b class="nc">&nbsp;                config?.builder?.connectTimeoutMillis,</b>
<b class="nc">&nbsp;                config?.builder?.environment,</b>
<b class="nc">&nbsp;                config?.builder?.protocol,</b>
<b class="nc">&nbsp;                config?.builder?.host,</b>
<b class="nc">&nbsp;                config?.builder?.appName,</b>
<b class="nc">&nbsp;                config?.builder?.appVersion,</b>
&nbsp;            )
<b class="nc">&nbsp;            CashconvClientRepository(</b>
<b class="nc">&nbsp;                settingsManager,</b>
<b class="nc">&nbsp;                CashconvApiService(</b>
<b class="nc">&nbsp;                    settingsManager,</b>
<b class="nc">&nbsp;                    httpClient,</b>
<b class="nc">&nbsp;                    config?.builder?.environment,</b>
<b class="nc">&nbsp;                    config?.builder?.protocol,</b>
<b class="nc">&nbsp;                    config?.builder?.host</b>
&nbsp;                ),
<b class="nc">&nbsp;                builder.floatingDigit</b>
&nbsp;            )
&nbsp;        }
&nbsp;    }
&nbsp;
<b class="fc">&nbsp;    init {</b>
<b class="fc">&nbsp;        instance = this</b>
<b class="pc">&nbsp;        if (builder.warmUpOnStartUp)</b>
<b class="nc">&nbsp;            load()</b>
<b class="fc">&nbsp;    }</b>
&nbsp;
&nbsp;    private fun load() {
<b class="nc">&nbsp;        Task.execute {</b>
<b class="nc">&nbsp;            repo.init()</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    fun destroy(reason: String) {
<b class="fc">&nbsp;        instance = null</b>
&nbsp;    }
&nbsp;
&nbsp;    fun clearData() {
<b class="fc">&nbsp;        settingsManager.clearAllSettings()</b>
&nbsp;    }
&nbsp;
&nbsp;    fun getCurrenciesRatesFlow(): CommonFlow&lt;List&lt;Currency&gt;&gt; {
<b class="fc">&nbsp;        return repo.currenciesRatesFlow.asCommonFlow()</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Fetches RocketLaunch from network and cache based on the configuration sent.
&nbsp;     * no cache available.
&nbsp;     * @return a Task array of RocketLaunch items.
&nbsp;     */
&nbsp;    fun getCurrencies(): Task&lt;List&lt;Currency&gt;&gt; {
<b class="fc">&nbsp;        return Task.execute {</b>
<b class="fc">&nbsp;            repo.getCurrencies()</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    fun fetchCurrencies(): Task&lt;List&lt;Currency&gt;&gt; {
<b class="fc">&nbsp;        return Task.execute {</b>
<b class="fc">&nbsp;            repo.fetchCurrencies()</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    fun fetchCurrenciesIfNeeded(): Task&lt;List&lt;Currency&gt;&gt; {
<b class="fc">&nbsp;        return Task.execute {</b>
<b class="fc">&nbsp;            repo.fetchCurrenciesIfNeeded()</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    fun getRates(): Task&lt;Array&lt;Currency&gt;&gt; {
<b class="fc">&nbsp;        return Task.execute {</b>
<b class="fc">&nbsp;            repo.getRates().toTypedArray()</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    fun fetchRates(): Task&lt;Array&lt;Currency&gt;&gt; {
<b class="fc">&nbsp;        return Task.execute {</b>
<b class="fc">&nbsp;            repo.fetchRates().toTypedArray()</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    fun shouldFetchRates(): Boolean {
<b class="fc">&nbsp;        return settingsManager.shouldFetchRates</b>
&nbsp;    }
&nbsp;
&nbsp;    fun fetchRatesIfNeeded(): Task&lt;List&lt;Currency&gt;&gt; {
<b class="fc">&nbsp;        return Task.execute {</b>
<b class="fc">&nbsp;            repo.fetchRatesIfNeeded()</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    fun getBaseCurrencyFlow(): CommonFlow&lt;Currency&gt; {
<b class="fc">&nbsp;        return repo.baseCurrencyFlow.asCommonFlow()</b>
&nbsp;    }
&nbsp;
&nbsp;    fun convert(amount: String?, from: Currency, to: Currency): String {
<b class="fc">&nbsp;        return repo.convert(amount, from.code, to.code)</b>
&nbsp;    }
&nbsp;
&nbsp;    @JsName(&quot;convertAmount&quot;)
&nbsp;    fun convert(amount: Amount): Amount {
<b class="fc">&nbsp;        return amount.copy(</b>
<b class="fc">&nbsp;            convertedValue = convert(amount.value, amount.currency, amount.convertCurrency)</b>
&nbsp;        )
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * We may need to pass some compulsory values to the builder.
&nbsp;     * Mandatory param values are part of the constructor.
&nbsp;     */
<b class="fc">&nbsp;    class Builder {</b>
&nbsp;
<b class="fc">&nbsp;        internal var warmUpOnStartUp: Boolean = true</b>
<b class="fc">&nbsp;        internal var repository: CashconvClientRepository? = null</b>
<b class="fc">&nbsp;        internal var settingsManager: SettingsManager? = null</b>
<b class="nc">&nbsp;        internal var config: Config? = null</b>
<b class="nc">&nbsp;        internal var floatingDigit: Int? = null</b>
<b class="nc">&nbsp;        internal var inMemorySettings: Boolean = false</b>
&nbsp;
&nbsp;        /**
&nbsp;         * set a listener for overall client events
&nbsp;         */
&nbsp;        fun withConfig(config: Config): Builder {
<b class="nc">&nbsp;            this.config = config</b>
<b class="nc">&nbsp;            return this</b>
&nbsp;        }
&nbsp;
&nbsp;        fun withFloatingDigit(digit: Int?): Builder {
<b class="pc">&nbsp;            if (digit != null &amp;&amp; digit &lt;= 0) return this</b>
<b class="fc">&nbsp;            floatingDigit = digit</b>
<b class="fc">&nbsp;            return this</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        fun withInMemorySettings(enabled: Boolean = true): Builder {</b>
<b class="nc">&nbsp;            inMemorySettings = enabled</b>
<b class="nc">&nbsp;            return this</b>
&nbsp;        }
&nbsp;
&nbsp;        internal fun withRepository(repository: CashconvClientRepository): Builder {
<b class="fc">&nbsp;            this.repository = repository</b>
<b class="fc">&nbsp;            return this</b>
&nbsp;        }
&nbsp;
&nbsp;        internal fun withSettingsManger(settingsManager: SettingsManager): Builder {
<b class="fc">&nbsp;            this.settingsManager = settingsManager</b>
<b class="fc">&nbsp;            return this</b>
&nbsp;        }
&nbsp;
&nbsp;        fun enableWarmUpOnStartUp(enable: Boolean): Builder {
<b class="fc">&nbsp;            this.warmUpOnStartUp = enable</b>
<b class="fc">&nbsp;            return this</b>
&nbsp;        }
&nbsp;
&nbsp;        fun build(): CashconvClientManager {
<b class="fc">&nbsp;            return instance ?: CashconvClientManager(this, config)</b>
&nbsp;        }
&nbsp;    }
&nbsp;}
&nbsp;
&nbsp;fun Amount.convert(): Amount {
&nbsp;    return CashconvClientManager.getInstanceOrNull()?.convert(this) ?: this
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2023-12-24 11:52</div>
</div>
</body>
</html>
